name: CI de Ruyman
on:
  push:
    branches: [ "main" ]

jobs:
  mi-primer-trabajo:
    runs-on: ubuntu-latest

    steps:
      - name: Descargar codigo
        uses: actions/checkout@v4
      
      - name: Verificar archivo
        run: grep "production" config/kubernetes.conf
        
      - name: Desplegar a ProducciÃ³n vÃ­a SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.LLAVE_PRIVADA_SSH }}
          port: ${{ secrets.PORT }}
          script: |
            echo "ðŸ”Œ ConexiÃ³n establecida con Ã©xito."
            echo "ðŸ‘¤ Soy el usuario: $(whoami)"
            echo "ðŸ“‚ Estoy en el directorio: $(pwd)"
            echo "ðŸš€ Listo para ejecutar comandos en el servidor."
      
       - name: Copiar archivos al servidor (Deploy)
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.LLAVE_PRIVADA_SSH }}
          port: ${{ secrets.PORT }}
          source: "projects/cv_it/index.html"     # 1. Le decimos dÃ³nde estÃ¡ realmente
          target: "/home/ruymang1/public_html/test10/cv_it"
          strip_components: 2                       # 2. EL TRUCO: Le decimos "ignora las 2 primeras carpetas (projects/cv_it) y copia solo el archivo"
      - name: Desplegar a ProducciÃ³n vÃ­a SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.LLAVE_PRIVADA_SSH }}
          port: ${{ secrets.PORT }}
          script: |
            echo "âœ… Despliegue completado."
            ls -la /home/ruymang1/public_html/index.html